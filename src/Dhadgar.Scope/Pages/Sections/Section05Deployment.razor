<section id="deployment" class="bg-gray-800 rounded-xl p-6 border border-indigo-700">
    <h2 class="text-2xl font-bold text-white mb-4">üåê Section 5: Deployment Topology</h2>
    
    <h3 class="text-xl font-semibold text-indigo-400 mb-3">High-Level Architecture</h3>
    <p class="text-gray-300 mb-6">Single Kubernetes cluster hosting dev/staging/prod as separate namespaces. Agent nodes run outside Kubernetes on isolated VLANs.</p>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">External Services</h3>
    <ul class="text-gray-300 space-y-1 mb-6">
        <li>‚Ä¢ Azure (Key Vault, AD, ACR, DevOps)</li>
        <li>‚Ä¢ Cloudflare (DNS, WAF, CDN)</li>
        <li>‚Ä¢ New Relic (Observability)</li>
    </ul>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">Kubernetes Cluster</h3>
    
    <h4 class="text-lg font-semibold text-purple-400 mt-4 mb-2">Infrastructure Layer</h4>
    <ul class="text-gray-300 space-y-1 mb-4">
        <li>‚Ä¢ cert-manager (TLS automation)</li>
        <li>‚Ä¢ Secrets Store CSI Driver (Azure Key Vault integration)</li>
        <li>‚Ä¢ ArgoCD (GitOps, read-only drift detection)</li>
        <li>‚Ä¢ Azure DevOps Build Agent (self-hosted pod)</li>
    </ul>

    <h4 class="text-lg font-semibold text-purple-400 mb-2">Platform Data Layer</h4>
    <ul class="text-gray-300 space-y-1 mb-4">
        <li>‚Ä¢ <strong class="text-white">PostgreSQL (platform):</strong> Application metadata (users, servers, agents, billing)</li>
        <li>‚Ä¢ <strong class="text-white">RabbitMQ:</strong> Message queue for async operations</li>
        <li>‚Ä¢ <strong class="text-white">Redis:</strong> Caching, session state</li>
    </ul>

    <h4 class="text-lg font-semibold text-purple-400 mb-2">User Data Layer</h4>
    <div class="bg-red-900/30 border border-red-700 rounded-lg p-4 mb-4">
        <p class="text-red-400 font-bold mb-2">üî¥ HARD RULE:</p>
        <p class="text-gray-300 text-sm">User data (game server databases, configs, saves) stored in separate PostgreSQL instance per environment. Platform DB and User DB must never share an instance.</p>
    </div>

    <table class="w-full text-sm border-collapse mb-6">
        <thead><tr class="bg-gray-700 text-white"><th class="border border-gray-600 p-2">Environment</th><th class="border border-gray-600 p-2">User DB Instance</th></tr></thead>
        <tbody class="text-gray-300">
            <tr><td class="border border-gray-600 p-2">Dev</td><td class="border border-gray-600 p-2">PostgreSQL (user-dev)</td></tr>
            <tr><td class="border border-gray-600 p-2">Staging</td><td class="border border-gray-600 p-2">PostgreSQL (user-staging)</td></tr>
            <tr><td class="border border-gray-600 p-2">Prod</td><td class="border border-gray-600 p-2">PostgreSQL (user-prod)</td></tr>
        </tbody>
    </table>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">Agent Nodes</h3>
    <ul class="text-gray-300 space-y-1 mb-6">
        <li>‚Ä¢ Run <strong class="text-white">outside Kubernetes</strong> on isolated VLANs</li>
        <li>‚Ä¢ Linux + Windows agents (cross-platform)</li>
        <li>‚Ä¢ Connect to cluster via <strong class="text-white">mTLS</strong></li>
        <li>‚Ä¢ Managed by Nodes Service (cert issuance, health checks)</li>
    </ul>

    <div class="bg-yellow-900/30 border border-yellow-700 rounded-lg p-4">
        <p class="text-yellow-400 font-semibold mb-2">üí° Future Note</p>
        <p class="text-gray-300 text-sm"><strong>When to split prod to dedicated cluster?</strong> When customer base grows to the point where resource contention or blast radius concerns justify the operational overhead (likely 500+ active servers).</p>
    </div>
</section>