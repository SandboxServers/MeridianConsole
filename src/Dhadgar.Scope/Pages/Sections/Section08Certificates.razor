<section id="certificates" class="bg-gray-800 rounded-xl p-6 border border-gray-700">
    <h2 class="text-2xl font-bold text-purple-400 mb-6 border-b border-purple-600 pb-2">
        8. Certificate Management
    </h2>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">Certificate Architecture Overview</h3>
    <div class="bg-gray-900 border border-gray-600 rounded-lg p-4 mb-6 font-mono text-xs overflow-x-auto">
        <pre class="text-gray-300">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CERTIFICATE MANAGEMENT                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   EXTERNAL (User-Facing):                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Let's Encrypt  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Cloudflare API â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  cert-manager   â”‚   â”‚
â”‚   â”‚  (ACME CA)      â”‚         â”‚  (DNS-01)       â”‚         â”‚  (Ingress only) â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â”‚   INTERNAL (Pod-to-Pod):                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         CILIUM SERVICE MESH                              â”‚   â”‚
â”‚   â”‚   â€¢ Automatic mTLS between all pods                                      â”‚   â”‚
â”‚   â”‚   â€¢ No manual cert management                                            â”‚   â”‚
â”‚   â”‚   â€¢ Covers: services, PostgreSQL, RabbitMQ, Redis                        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â”‚   AGENT CERTIFICATES:                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    NODES SERVICE (Agent Cert Manager)                    â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â”‚  Bootstrap: Token â†’ Register â†’ Issue cert â†’ Establish mTLS              â”‚   â”‚
â”‚   â”‚  Renewal: Automated at 45 days before expiry                             â”‚   â”‚
â”‚   â”‚  DNS: agent-{id}.nodes.meridianconsole.com                              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </pre>
    </div>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">Certificate Types</h3>
    <table class="w-full text-sm border-collapse mb-6">
        <thead>
            <tr class="bg-gray-700 text-white">
                <th class="border border-gray-600 p-2 text-left">Type</th>
                <th class="border border-gray-600 p-2 text-left">Scope</th>
                <th class="border border-gray-600 p-2 text-left">Manager</th>
                <th class="border border-gray-600 p-2 text-left">Renewal</th>
            </tr>
        </thead>
        <tbody class="text-gray-300">
            <tr class="bg-gray-800"><td class="border border-gray-600 p-2">Ingress (User-facing)</td><td class="border border-gray-600 p-2">*.meridianconsole.com</td><td class="border border-gray-600 p-2">cert-manager</td><td class="border border-gray-600 p-2">45 days (automated)</td></tr>
            <tr><td class="border border-gray-600 p-2">Internal Pod-to-Pod</td><td class="border border-gray-600 p-2">All cluster services</td><td class="border border-gray-600 p-2">Cilium</td><td class="border border-gray-600 p-2">Automatic (mesh)</td></tr>
            <tr class="bg-gray-800"><td class="border border-gray-600 p-2">Agent mTLS</td><td class="border border-gray-600 p-2">agent-{id}.nodes.*</td><td class="border border-gray-600 p-2">Nodes Service</td><td class="border border-gray-600 p-2">45 days (automated)</td></tr>
        </tbody>
    </table>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">Agent Bootstrap Flow</h3>
    <div class="bg-gray-900 border border-gray-600 rounded-lg p-4 mb-6 font-mono text-xs overflow-x-auto">
        <pre class="text-gray-300">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AGENT BOOTSTRAP SEQUENCE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  1. ADMIN GENERATES TOKEN                                                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     POST /nodes/tokens      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚  Admin  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Nodes     â”‚                     â”‚
â”‚     â”‚   UI    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   :5040     â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     { token: "xxx" }        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                     (15 min expiry)                                              â”‚
â”‚                                                                                  â”‚
â”‚  2. AGENT REGISTERS                                                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     POST /nodes/register    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚  Agent  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Nodes     â”‚                     â”‚
â”‚     â”‚  (new)  â”‚     { token: "xxx" }        â”‚   :5040     â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                    â”‚                             â”‚
â”‚  3. NODES SERVICE PROVISIONS CERT                  â”‚                             â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                     â–¼                                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚  â€¢ Create DNS entry: agent-{id}.nodes.meridianconsole.com              â”‚ â”‚
â”‚     â”‚  â€¢ Request cert from Let's Encrypt (via Cloudflare API DNS-01)         â”‚ â”‚
â”‚     â”‚  â€¢ Store cert metadata in nodes_db                                      â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                                                            â”‚
â”‚  4. PUSH CERT TO AGENT                                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     cert + private key      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚  Agent  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   Nodes     â”‚                     â”‚
â”‚     â”‚  (new)  â”‚     (over initial TLS)      â”‚   :5040     â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                                  â”‚
â”‚  5. ESTABLISH mTLS                                                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     mTLS connection         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚  Agent  â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚   Nodes     â”‚                     â”‚
â”‚     â”‚  (reg)  â”‚     (ongoing comms)         â”‚   :5040     â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </pre>
    </div>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">DNS-01 Challenge Flow</h3>
    <table class="w-full text-sm border-collapse mb-6">
        <thead>
            <tr class="bg-gray-700 text-white">
                <th class="border border-gray-600 p-2 text-left">Step</th>
                <th class="border border-gray-600 p-2 text-left">Action</th>
                <th class="border border-gray-600 p-2 text-left">Component</th>
            </tr>
        </thead>
        <tbody class="text-gray-300">
            <tr class="bg-gray-800"><td class="border border-gray-600 p-2">1</td><td class="border border-gray-600 p-2">Request new certificate order</td><td class="border border-gray-600 p-2">â†’ Let's Encrypt ACME</td></tr>
            <tr><td class="border border-gray-600 p-2">2</td><td class="border border-gray-600 p-2">Create TXT record via API</td><td class="border border-gray-600 p-2">â†’ Cloudflare API</td></tr>
            <tr class="bg-gray-800"><td class="border border-gray-600 p-2">3</td><td class="border border-gray-600 p-2">Validate challenge</td><td class="border border-gray-600 p-2">â†’ Let's Encrypt ACME</td></tr>
            <tr><td class="border border-gray-600 p-2">4</td><td class="border border-gray-600 p-2">Delete TXT record</td><td class="border border-gray-600 p-2">â†’ Cloudflare API</td></tr>
            <tr class="bg-gray-800"><td class="border border-gray-600 p-2">5</td><td class="border border-gray-600 p-2">Store/push certificate</td><td class="border border-gray-600 p-2">â†’ K8s Secret / Agent</td></tr>
        </tbody>
    </table>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">Renewal Policy</h3>
    <div class="bg-green-900/30 border border-green-700 rounded-lg p-4 mb-6">
        <p class="text-green-400 font-semibold mb-2">âœ… Automated Renewal</p>
        <ul class="text-gray-300 text-sm space-y-1">
            <li>â€¢ <strong class="text-white">Validity:</strong> 90 days (Let's Encrypt standard)</li>
            <li>â€¢ <strong class="text-white">Renewal trigger:</strong> 45 days before expiry (50% lifetime)</li>
            <li>â€¢ <strong class="text-white">Automation:</strong> Fully automated â€” no manual intervention</li>
            <li>â€¢ <strong class="text-white">Alerting:</strong> Alert if renewal fails 30 days before expiry</li>
        </ul>
    </div>

    <h3 class="text-xl font-semibold text-indigo-400 mb-3">Internal Services (Cilium)</h3>
    <div class="bg-blue-900/30 border border-blue-700 rounded-lg p-4">
        <p class="text-blue-400 font-semibold mb-2">ğŸ”’ Pod-to-Pod Encryption</p>
        <p class="text-gray-300 text-sm mb-2">Cilium service mesh handles all internal mTLS automatically:</p>
        <ul class="text-gray-300 text-sm space-y-1">
            <li>â€¢ All 12 control plane services</li>
            <li>â€¢ PostgreSQL connections (Platform DB, User DB)</li>
            <li>â€¢ RabbitMQ connections</li>
            <li>â€¢ Redis connections</li>
            <li>â€¢ Prometheus/Loki scraping</li>
        </ul>
        <p class="text-gray-400 text-xs mt-2 italic">No manual certificate management required for internal services.</p>
    </div>
</section>