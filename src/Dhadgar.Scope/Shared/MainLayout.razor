@inherits LayoutComponentBase
@inject IJSRuntime JS

<MudLayout Class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-950 to-black text-white">
    <!-- Mobile AppBar -->
    <MudAppBar Elevation="0" Class="lg:hidden" Style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; margin: 1rem;">
        <MudLink Href="/" Underline="Underline.None" Color="Color.Inherit">
            <div class="text-sm text-white/60">Meridian Console</div>
            <div class="text-xl font-bold tracking-tight">Scope</div>
        </MudLink>
        <MudSpacer />
        <MudIconButton Icon="☰"
                       Color="Color.Inherit"
                       Edge="Edge.End"
                       OnClick="@ToggleSidebar"
                       Style="border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05);" />
    </MudAppBar>

    <!-- Desktop Drawer (always open) -->
    <MudDrawer @bind-Open="_desktopDrawerOpen"
               Anchor="Anchor.Left"
               Elevation="0"
               Variant="@DrawerVariant.Persistent"
               Class="hidden lg:block"
               ClipMode="DrawerClipMode.Never"
               Style="width: 320px; position: sticky; top: 1.5rem; margin-left: 1rem; max-height: calc(100vh - 3rem);">
        <ScopeSidebar />
    </MudDrawer>

    <!-- Mobile Drawer (responsive) -->
    <MudDrawer @bind-Open="_sidebarOpen"
               Anchor="Anchor.Left"
               Elevation="16"
               Variant="@DrawerVariant.Temporary"
               Class="lg:hidden"
               ClipMode="DrawerClipMode.Always"
               Style="width: min(92vw, 380px); background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(24px); border-right: 1px solid rgba(255,255,255,0.1);">
        <MudDrawerHeader Style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div class="flex items-center justify-between w-full">
                <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.6);">Menu</MudText>
                <MudIconButton Icon="✕"
                               Color="Color.Inherit"
                               Size="Size.Small"
                               OnClick="@CloseSidebar"
                               Style="border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05);" />
            </div>
        </MudDrawerHeader>
        <div class="mt-4 px-4">
            <ScopeSidebar OnNavigate="CloseSidebar" />
        </div>
    </MudDrawer>

    <MudMainContent Class="px-4 py-6 2xl:px-8">
        <div class="scope-content">
            @Body
        </div>
    </MudMainContent>
</MudLayout>

@code {
    private bool _sidebarOpen;
    private bool _desktopDrawerOpen = true;

    private async Task ToggleSidebar()
    {
        _sidebarOpen = !_sidebarOpen;
        await JS.InvokeVoidAsync("scopeUi.setScrollLock", _sidebarOpen);
    }

    private async Task CloseSidebar()
    {
        if (!_sidebarOpen)
            return;

        _sidebarOpen = false;
        await JS.InvokeVoidAsync("scopeUi.setScrollLock", false);
    }
}
