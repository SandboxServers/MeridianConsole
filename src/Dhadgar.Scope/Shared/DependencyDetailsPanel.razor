@using Dhadgar.Scope.Services

<MudPaper Class="@Class" Elevation="0">
    @if (Selected is null)
    {
        <div>
            <MudText Typo="Typo.body2" Class="font-semibold">Nothing selected</MudText>
            <MudText Typo="Typo.body2" Class="mt-2" Style="color: rgba(255,255,255,0.7);">
                Select a node on the graph to see details here.
            </MudText>
            <MudDivider Class="my-4" Style="border-color: rgba(255,255,255,0.1);" />
            <MudText Typo="Typo.caption" Style="color: rgba(255,255,255,0.6);">
                Layers (top to bottom): External, Presentation, Core, Business, Foundation
            </MudText>
        </div>
    }
    else
    {
        <div class="space-y-4">
            <div>
                <MudText Typo="Typo.caption" Class="font-semibold tracking-wide" Style="color: rgba(255,255,255,0.6);">Node</MudText>
                <MudText Typo="Typo.h5" Class="mt-1 font-bold">
                    @(Selected.Emoji) @Selected.Name
                </MudText>
                <div class="mt-2 flex flex-wrap items-center gap-2">
                    <MudChip T="string" Size="Size.Small" Style="background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.7);">@Selected.Layer</MudChip>
                    @if (Selected.Port is not null)
                    {
                        <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.6);">Port:</MudText>
                        <MudText Typo="Typo.body2" Class="font-mono">@Selected.Port</MudText>
                    }
                </div>
                @if (!string.IsNullOrWhiteSpace(Selected.Description))
                {
                    <MudText Typo="Typo.body2" Class="mt-3" Style="color: rgba(255,255,255,0.8);">@Selected.Description</MudText>
                }
            </div>

            @if (Selected.Responsibilities.Count > 0)
            {
                <div>
                    <MudText Typo="Typo.caption" Class="font-semibold tracking-wide" Style="color: rgba(255,255,255,0.6);">Responsibilities</MudText>
                    <MudList T="string" Dense="true" Class="mt-2" Style="padding: 0;">
                        @foreach (var r in Selected.Responsibilities)
                        {
                            <MudListItem T="string" Dense="true" Style="padding-left: 0; min-height: auto;">
                                <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.8);">- @r</MudText>
                            </MudListItem>
                        }
                    </MudList>
                </div>
            }

            @if (Selected.Endpoints.Count > 0)
            {
                <div>
                    <MudText Typo="Typo.caption" Class="font-semibold tracking-wide" Style="color: rgba(255,255,255,0.6);">Endpoints / Notes</MudText>
                    <MudList T="string" Dense="true" Class="mt-2" Style="padding: 0;">
                        @foreach (var e in Selected.Endpoints)
                        {
                            <MudListItem T="string" Dense="true" Style="padding-left: 0; min-height: auto;">
                                <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.8);">- @e</MudText>
                            </MudListItem>
                        }
                    </MudList>
                </div>
            }

            <div class="grid gap-4 md:grid-cols-2">
                <div>
                    <MudText Typo="Typo.caption" Class="font-semibold tracking-wide" Style="color: rgba(255,255,255,0.6);">Depends on</MudText>
                    @if (Selected.Dependencies.Count == 0)
                    {
                        <MudText Typo="Typo.body2" Class="mt-2" Style="color: rgba(255,255,255,0.6);">None</MudText>
                    }
                    else
                    {
                        <div class="mt-2 space-y-1">
                            @foreach (var d in Selected.Dependencies.OrderBy(x => x))
                            {
                                <div>
                                    <MudLink Color="Color.Primary"
                                             Underline="Underline.Hover"
                                             OnClick="() => SelectByName.InvokeAsync(d)"
                                             Style="cursor: pointer; font-size: 0.875rem;">
                                        @d
                                    </MudLink>
                                </div>
                            }
                        </div>
                    }
                </div>

                <div>
                    <MudText Typo="Typo.caption" Class="font-semibold tracking-wide" Style="color: rgba(255,255,255,0.6);">Used by</MudText>
                    @if (Selected.Dependents.Count == 0)
                    {
                        <MudText Typo="Typo.body2" Class="mt-2" Style="color: rgba(255,255,255,0.6);">None</MudText>
                    }
                    else
                    {
                        <div class="mt-2 space-y-1">
                            @foreach (var d in Selected.Dependents.OrderBy(x => x))
                            {
                                <div>
                                    <MudLink Color="Color.Primary"
                                             Underline="Underline.Hover"
                                             OnClick="() => SelectByName.InvokeAsync(d)"
                                             Style="cursor: pointer; font-size: 0.875rem;">
                                        @d
                                    </MudLink>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>

            <div class="pt-2">
                <MudButton OnClick="() => Clear.InvokeAsync()"
                           Variant="Variant.Filled"
                           Size="Size.Small"
                           Class="rounded-xl"
                           Style="background: rgba(255,255,255,0.1); text-transform: none;">
                    Clear selection
                </MudButton>
            </div>
        </div>
    }
</MudPaper>

@code {
    [Parameter] public DependencyNode? Selected { get; set; }
    [Parameter] public EventCallback<string> SelectByName { get; set; }
    [Parameter] public EventCallback Clear { get; set; }
    [Parameter] public string Class { get; set; } = "rounded-2xl border border-white/10 bg-white/5 p-6";
}
