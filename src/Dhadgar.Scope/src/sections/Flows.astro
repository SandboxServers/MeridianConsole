---
// Section 11: Network Flows
---

<div class="rounded-2xl border border-white/10 bg-white/5 p-6">
  <h2 class="mb-4 text-2xl font-bold">Section 11: Network Flows</h2>

  <h3 class="mb-3 text-lg font-semibold text-indigo-400">Traffic Patterns</h3>
  <p class="mb-4 text-white/70">
    All external traffic enters through Cloudflare, then the YARP Gateway. Internal services
    communicate via HTTP and RabbitMQ.
  </p>

  <h3 class="mb-3 text-lg font-semibold text-indigo-400">Ingress Flow</h3>
  <div class="mb-6 rounded-2xl border border-white/10 bg-black/35 p-4 overflow-x-auto">
    <code>
      User → Cloudflare (WAF/CDN) → YARP Gateway → Target Service<br />
      Agent → Cloudflare → Gateway → Control Plane Services
    </code>
  </div>

  <h3 class="mb-3 text-lg font-semibold text-indigo-400">Internal Communication</h3>
  <table class="mb-6 w-full border-collapse text-sm">
    <thead>
      <tr>
        <th class="border border-white/10 bg-white/5 px-2.5 py-2 text-left text-white/90"
          >Protocol</th
        >
        <th class="border border-white/10 bg-white/5 px-2.5 py-2 text-left text-white/90"
          >Use Case</th
        >
        <th class="border border-white/10 bg-white/5 px-2.5 py-2 text-left text-white/90"
          >Examples</th
        >
      </tr>
    </thead>
    <tbody>
      <tr
        ><td class="border border-white/10 px-2.5 py-2 align-top">HTTP/REST</td><td
          class="border border-white/10 px-2.5 py-2 align-top">Synchronous requests</td
        ><td class="border border-white/10 px-2.5 py-2 align-top">Service-to-service APIs</td></tr
      >
      <tr
        ><td class="border border-white/10 px-2.5 py-2 align-top">RabbitMQ/AMQP</td><td
          class="border border-white/10 px-2.5 py-2 align-top">Async events, commands</td
        ><td class="border border-white/10 px-2.5 py-2 align-top">Provisioning, notifications</td
        ></tr
      >
      <tr
        ><td class="border border-white/10 px-2.5 py-2 align-top">SignalR/WSS</td><td
          class="border border-white/10 px-2.5 py-2 align-top">Real-time</td
        ><td class="border border-white/10 px-2.5 py-2 align-top"
          >Console streaming, status updates</td
        ></tr
      >
      <tr
        ><td class="border border-white/10 px-2.5 py-2 align-top">PostgreSQL</td><td
          class="border border-white/10 px-2.5 py-2 align-top">Data persistence</td
        ><td class="border border-white/10 px-2.5 py-2 align-top">Each service to its own DB</td
        ></tr
      >
    </tbody>
  </table>

  <h3 class="mb-3 text-lg font-semibold text-indigo-400">Agent Communication</h3>
  <div class="rounded-2xl border border-indigo-500/35 bg-indigo-500/[0.12] p-4">
    Agents initiate all connections outbound to the control plane. No inbound ports required on
    customer infrastructure.
  </div>
</div>
