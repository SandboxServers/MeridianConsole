{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Yarp.ReverseProxy": "Information"
    }
  },
  "AllowedHosts": "localhost;api.meridianconsole.com;*.meridianconsole.com",
  "Authentication": {
    "Enabled": false,
    "EnforcementMode": "optional"
  },
  "Auth": {
    "Issuer": "https://meridianconsole.com/api/v1/identity",
    "Audience": "meridian-api",
    "ClockSkewSeconds": 30
  },
  "Cors": {
    "AllowedOrigins": [
      "https://panel.meridianconsole.com",
      "https://cart.meridianconsole.com",
      "https://meridianconsole.com",
      "https://dev.meridianconsole.com",
      "http://localhost:4321",
      "http://localhost:4322"
    ]
  },
  "OpenTelemetry": {
    "OtlpEndpoint": ""
  },
  "RateLimiting": {
    "Policies": {
      "Global": {
        "PermitLimit": 1000,
        "WindowSeconds": 60
      },
      "PerTenant": {
        "PermitLimit": 100,
        "ReplenishPerSecond": 50,
        "QueueLimit": 0
      },
      "PerAgent": {
        "PermitLimit": 500,
        "WindowSeconds": 60
      },
      "Auth": {
        "PermitLimit": 30,
        "WindowSeconds": 60
      }
    }
  },
  "CircuitBreaker": {
    "FailureThreshold": 5,
    "SuccessThreshold": 2,
    "OpenDurationSeconds": 30,
    "FailureStatusCodes": [500, 502, 503, 504],
    "IncludeServiceNameInErrors": false
  },
  "Readyz": {
    "RequiredClusters": [
      "identity",
      "secrets"
    ],
    "MinimumAvailableDestinations": 1,
    "FailOnMissingCluster": true
  },
  "Cloudflare": {
    "EnableDynamicFetch": true,
    "RefreshIntervalMinutes": 60,
    "FetchTimeoutSeconds": 30
  },
  "ReverseProxy": {
    "HttpClient": {
      "RequestTimeout": "00:00:30"
    },
    "Routes": {
      "identity-internal-block": {
        "ClusterId": "identity",
        "Order": 1,
        "Match": { "Path": "/api/v1/identity/internal/{**catch-all}" },
        "AuthorizationPolicy": "DenyAll"
      },
      "betterauth-route": {
        "ClusterId": "betterauth",
        "Order": 10,
        "Match": { "Path": "/api/v1/betterauth/{**catch-all}" },
        "AuthorizationPolicy": "Anonymous",
        "RateLimiterPolicy": "Auth"
      },
      "identity-route": {
        "ClusterId": "identity",
        "Order": 10,
        "Match": { "Path": "/api/v1/identity/{**catch-all}" },
        "AuthorizationPolicy": "Anonymous",
        "RateLimiterPolicy": "Auth",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/identity" }
        ]
      },
      "billing-route": {
        "ClusterId": "billing",
        "Order": 20,
        "Match": { "Path": "/api/v1/billing/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/billing" }
        ]
      },
      "servers-route": {
        "ClusterId": "servers",
        "Order": 20,
        "Match": { "Path": "/api/v1/servers/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/servers" }
        ]
      },
      "nodes-route": {
        "ClusterId": "nodes",
        "Order": 20,
        "Match": { "Path": "/api/v1/nodes/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/nodes" }
        ]
      },
      "tasks-route": {
        "ClusterId": "tasks",
        "Order": 20,
        "Match": { "Path": "/api/v1/tasks/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/tasks" }
        ]
      },
      "files-route": {
        "ClusterId": "files",
        "Order": 20,
        "Match": { "Path": "/api/v1/files/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/files" }
        ]
      },
      "console-api-route": {
        "ClusterId": "console",
        "Order": 20,
        "Match": { "Path": "/api/v1/console/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/console" }
        ]
      },
      "console-hub-route": {
        "ClusterId": "console",
        "Order": 20,
        "Match": { "Path": "/hubs/console/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant"
      },
      "mods-route": {
        "ClusterId": "mods",
        "Order": 20,
        "Match": { "Path": "/api/v1/mods/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/mods" }
        ]
      },
      "notifications-route": {
        "ClusterId": "notifications",
        "Order": 20,
        "Match": { "Path": "/api/v1/notifications/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/notifications" }
        ]
      },
      "firewall-route": {
        "ClusterId": "firewall",
        "Order": 20,
        "Match": { "Path": "/api/v1/firewall/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/firewall" }
        ]
      },
      "secrets-route": {
        "ClusterId": "secrets",
        "Order": 20,
        "Match": { "Path": "/api/v1/secrets/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/secrets" }
        ]
      },
      "discord-route": {
        "ClusterId": "discord",
        "Order": 20,
        "Match": { "Path": "/api/v1/discord/{**catch-all}" },
        "AuthorizationPolicy": "TenantScoped",
        "RateLimiterPolicy": "PerTenant",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/discord" }
        ]
      },
      "agents-route": {
        "ClusterId": "nodes",
        "Order": 30,
        "Match": { "Path": "/api/v1/agents/{**catch-all}" },
        "AuthorizationPolicy": "Agent",
        "RateLimiterPolicy": "PerAgent",
        "Transforms": [
          { "PathRemovePrefix": "/api/v1/agents" }
        ]
      }
    },
    "Clusters": {
      "betterauth": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5130/"
          }
        }
      },
      "identity": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5010/"
          }
        }
      },
      "billing": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5020/"
          }
        }
      },
      "servers": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5030/"
          }
        }
      },
      "nodes": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5040/"
          }
        }
      },
      "tasks": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5050/"
          }
        }
      },
      "files": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "HttpRequest": {
          "ActivityTimeout": "00:05:00"
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5060/"
          }
        }
      },
      "console": {
        "LoadBalancingPolicy": "RoundRobin",
        "SessionAffinity": {
          "Enabled": true,
          "Policy": "Cookie",
          "FailurePolicy": "Redistribute",
          "AffinityKeyName": ".Dhadgar.Console.Affinity",
          "Cookie": {
            "HttpOnly": true,
            "SameSite": "Lax",
            "SecurePolicy": "Always",
            "Expiration": "01:00:00",
            "IsEssential": true
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5070/"
          }
        }
      },
      "mods": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5080/"
          }
        }
      },
      "notifications": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5090/"
          }
        }
      },
      "firewall": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5100/"
          }
        }
      },
      "secrets": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5110/"
          }
        }
      },
      "discord": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/healthz"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "Destinations": {
          "d1": {
            "Address": "http://localhost:5120/"
          }
        }
      }
    }
  }
}
